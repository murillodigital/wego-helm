---
apiVersion: source.toolkit.fluxcd.io/v1beta1
kind: GitRepository
metadata:
  name: {{ .Values.ClusterOwner }}-bootstrap
  namespace: {{ .Release.Namespace }}
spec:
  interval: 1m
  url: {{ .Values.GitRepositoryUrl }}
  ref:
    branch: {{ .Values.GitBranch | default "main" }}
{{- if .Values.PrivateRepo }}
  secretRef:
    name: {{ .Values.ClusterOwner }}-secret
---
apiVersion: v1
kind: Secret
metadata:
  name: {{ .Values.ClusterOwner }}-secret
  namespace: {{ .Release.Namespace }}
type: Opaque
data:
{{- if .Values.UseSSH }}
  identity: {{ .Values.SSHIdentity }}
  known_hosts: {{ .Values.KnownHosts }}
{{- else }}
# Use case for HTTPS repos not yet supported
  username: "notready"
  password: "yet"
{{- end }}
{{- end }}
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta1
kind: Kustomization
metadata:
  name: {{ .Values.ClusterOwner }}-bootstrap
  namespace: {{ .Release.Namespace }}
spec:
  interval: 1m
  path: {{ .Values.GitRepositoryPath }}
  prune: true
  sourceRef:
    kind: GitRepository
    name: {{ .Values.ClusterOwner }}-bootstrap
...